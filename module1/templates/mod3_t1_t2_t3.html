{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Ideation - Business Type</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#1F2937] min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-7xl mx-auto relative pt-14 md:pt-0">
            <!-- butotn -->
            <a href="javascript:history.back()" 
               class="inline-flex items-center text-[#E5E7EB] hover:text-[#22C55E] transition-colors absolute top-4 left-4 md:top-0 md:left-0 z-10">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back
            </a>
            
            <h3 class="text-3xl font-bold text-center text-[#E5E7EB] mb-10 md:mx-16">Where would you like to start your journey?</h3>
            
            <!-- increase spacing of cards -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <!-- Home-Based Business -->
                <div class="bg-[#E5E7EB] rounded-xl shadow-lg hover:shadow-xl hover:border-[#22C55E] transition-all duration-300 p-6 relative location-card" id="home-based-card">
                    <img src="{% static 'module1/images/laptop.png' %}" alt="Laptop icon" class="absolute w-16 h-16 bg-white rounded-lg shadow top-[120px] right-8 z-10">
                    <div class="w-full h-36 rounded-lg mb-4 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c" alt="Home office" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-bold text-[#1F2937] location-title flex items-center lg:h-auto md:h-12">HOME-BASED</div>
                    <div class="text-sm text-[#3B82F6] font-semibold mb-3">$2000 - $10000 / MONTH</div>
                    <p class="text-sm text-[#1F2937] mt-2 mb-4 desc-preview">
                        A home-based business is a company run from the owner's home, offering flexibility and low startup costs. 
                        It often includes freelancing, e-commerce, or consulting, allowing entrepreneurs to manage their schedules and reduce overhead expenses. 
                        However, challenges like limited growth potential and distractions may arise.
                    </p>
                    <span class="text-sm font-semibold text-[#1F2937]">Target Market</span>
                    <ul class="list-disc pl-5 space-y-1 text-[#1F2937] text-sm my-2">
                        <li>Teens and young adults</li>
                        <li>Small businesses</li>
                        <li>Event organizers</li>
                    </ul>
                    <div class="mt-4 space-y-2 text-sm text-[#1F2937]">
                        <div class="flex items-center justify-between">
                            <span>Foot Traffic</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Resources</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Community</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-[#3B82F6] font-semibold text-sm">
                        3 Employees max
                    </div>
                    <button class="mt-4 w-full bg-[#25c247] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#10942d]/80 transition-all duration-300" onclick="openModal('home-based')">
                        Do Market Research
                    </button>
                </div>

                <!-- Physical Store -->
                <div class="bg-[#E5E7EB] rounded-xl shadow-lg hover:shadow-xl hover:border-[#22C55E] transition-all duration-300 p-6 relative location-card" id="physical-store-card">
                    <img src="{% static 'module1/images/shoppingbag.png' %}" alt="Shopping bag icon" class="absolute w-16 h-16 bg-white rounded-lg shadow top-[120px] right-8 z-10">
                    <div class="w-full h-36 rounded-lg mb-4 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8" alt="Retail store" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-bold text-[#1F2937] location-title flex items-center lg:h-auto md:h-12">PHYSICAL STORE</div>
                    <div class="text-sm text-[#3B82F6] font-semibold mb-3">$5000 - $20,000 / MONTH</div>
                    <p class="text-sm text-[#1F2937] mt-2 mb-4 desc-preview">
                        Physical store businesses are brick-and-mortar establishments where products or services are sold directly to customers. 
                        These businesses operate from a fixed location, such as a retail shop, department store, grocery store, restaurant, or boutique, and rely on in-person transactions and customer interaction.
                    </p>
                    <span class="text-sm font-semibold text-[#1F2937]">Target Market</span>
                    <ul class="list-disc pl-5 space-y-1 text-[#1F2937] text-sm my-2">
                        <li>Professionals needing bespoke suits</li>
                        <li>Fashion-forward individuals</li>
                        <li>High-income earners</li>
                    </ul>
                    <div class="mt-4 space-y-2 text-sm text-[#1F2937]">
                        <div class="flex items-center justify-between">
                            <span>Foot Traffic</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Resources</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Community</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-[#3B82F6] font-semibold text-sm">
                        10 Employees max
                    </div>
                    <button class="mt-4 w-full bg-[#25c247] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#10942d]/80 transition-all duration-300" onclick="openModal('physical-store')">
                        Do Market Research
                    </button>
                </div>

                <!-- Commercial Space -->
                <div class="bg-[#E5E7EB] rounded-xl shadow-lg hover:shadow-xl hover:border-[#22C55E] transition-all duration-300 p-6 relative location-card" id="commercial-space-card">
                    <img src="{% static 'module1/images/building.png' %}" alt="Building icon" class="absolute w-16 h-16 bg-white rounded-lg shadow top-[120px] right-8 z-10">
                    <div class="w-full h-36 rounded-lg mb-4 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1486406146926-c627a92ad1ab" alt="Office building" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-bold text-[#1F2937] location-title flex items-center lg:h-auto md:h-12">COMMERCIAL SPACE</div>
                    <div class="text-sm text-[#3B82F6] font-semibold mb-3">$7000 - $25,000 / MONTH</div>
                    <p class="text-sm text-[#1F2937] mt-2 mb-4 desc-preview">
                        Commercial space businesses involve renting or leasing properties that are used for business purposes, such as office buildings, retail spaces, or industrial facilities. 
                        These businesses cater to organizations or individuals who need a physical location for operations, offering a range of services from leasing to property management.
                    </p>
                    <span class="text-sm font-semibold text-[#1F2937]">Target Market</span>
                    <ul class="list-disc pl-5 space-y-1 text-[#1F2937] text-sm my-2">
                        <li>Working professionals</li>
                        <li>Stress-relief seekers</li>
                        <li>Health-conscious individuals</li>
                    </ul>
                    <div class="mt-4 space-y-2 text-sm text-[#1F2937]">
                        <div class="flex items-center justify-between">
                            <span>Foot Traffic</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Resources</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Community</span>
                            <div class="flex space-x-1">
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-[#3B82F6] rounded"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-[#3B82F6] font-semibold text-sm">
                        20 Employees max
                    </div>
                    <button class="mt-4 w-full bg-[#25c247] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#10942d]/80 transition-all duration-300" onclick="openModal('commercial-space')">
                        Do Market Research
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Market Research Findings Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-[#E5E7EB] border border-[#62666e] rounded-xl shadow-lg p-6 w-96 mx-auto">
                <div class="border-b border-[#62666e] p-4 relative">
                    <h5 class="text-xl font-semibold text-[#1F2937]">Market Research Findings</h5>
                </div>
                <!-- Loading Placeholder -->
                <div class="p-4" id="dummy-div">
                    <p class="text-sm text-[#1F2937]">
                        Loading results...
                    </p>
                </div>
                <!-- Research Results -->
                <div class="p-4 hidden" id="result-div">
                    <p class="text-sm text-[#1F2937]" id="adv">
                        
                    </p><br>
                    <p class="text-sm text-[#1F2937]" id="disadv">

                    </p><br>
                    <p class="text-sm text-[#1F2937]"><strong>Proceed?</strong></p>
                    <!-- Form for Proceeding with Research -->
                    <form id="marketResearchForm" method="POST" action="{% url 'save_business_location' %}">
                        {% csrf_token %}
                        <div class="hidden">
                            {{form.name}}
                        </div>
                        {{form.targetMarket}}
                        {{form.maxNumberOfWorkers}}
                        {{form.businessLocation}}

                        <div class="flex justify-between p-4 border-t border-[#62666e]">
                            <button id="closebtn" type="button" onclick="closeModal()" 
                                class="bg-[#c22525] text-white px-4 py-2 rounded-lg hover:bg-[#bf1717]/80 transition-all duration-300">
                                Cancel
                            </button>
                            
                            <button type="submit" id="submitbtn"
                                class="bg-[#25c247] text-white px-4 py-2 rounded-lg hover:bg-[#10942d]/80 transition-all duration-300">
                                Yes, Proceed
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="{% static 'player.js' %}" ></script>
    <!-- <script type="text/javascript" src="{% static 'mod3t1t2t3.js' %}" ></script> -->
    <script>
        let locationData = {
            "home-based": {
                location: "Home-Based",
                maxNumberOfWorkers: 3,
                research_adv: "✅ Over 69% of home-based businesses earn at least $50,000 annually, showing strong potential for growth and profitability.",
                research_disadv: "⚠️ Over 50% of home-based businesses fail due to factors like cash flow issues and ineffective marketing strategies."
            },
            "physical-store": {
                location: "Physical Store",
                maxNumberOfWorkers: 10,
                research_adv: "✅ Over 55% of consumers still prefer to shop in physical stores engage products before purchasing.",
                research_disadv: "⚠️ Over 20% of physical stores businesses fail because of high overhead costs, poor location choices, and shifting consumer behavior toward online shopping"
            },
            "commercial-space": {
                location: "Commercial Space",
                maxNumberOfWorkers: 20,
                research_adv: "✅ Over 20-35% increase in customer acquisition compared to home-based operations, primarily due to increased visibility, foot traffic, and client trust.",
                research_disadv: "⚠️ Over 40% of businesses in commercial spaces fail because of high rent costs, bad location selection, and low demand factors."
            }
        };
        function openModal(id) {
            const selectedLocationData = locationData[id];

            console.log(locationData[id])

            let modal = document.getElementById("modal");
            let adv = modal.querySelector("#adv").textContent = selectedLocationData.research_adv;
            let disadv = modal.querySelector("#disadv").textContent = selectedLocationData.research_disadv;

            let resultDiv = modal.querySelector("#result-div");
            let dummyDiv = modal.querySelector("#dummy-div");
            let cancelButton = modal.querySelector("#closebtn");
            let proceedButton = modal.querySelector("#submitbtn");
    
            document.getElementById("businessLocation").value = selectedLocationData.location;
            document.getElementById("maxNumberOfWorkers").value = selectedLocationData.maxNumberOfWorkers;

            document.getElementById("name").removeAttribute("required");
            cancelButton.disabled = true;
            proceedButton.disabled = true;
            cancelButton.classList.add("opacity-50", "cursor-not-allowed");
            proceedButton.classList.add("opacity-50", "cursor-not-allowed");
        
            modal.classList.remove("hidden");  
            resultDiv.classList.add("hidden"); 

            setTimeout(() => {
                dummyDiv.classList.add("hidden");
                resultDiv.classList.remove("hidden"); // Reveal after delay
                cancelButton.disabled = false;
                proceedButton.disabled = false;
                cancelButton.classList.remove("opacity-50", "cursor-not-allowed");
                proceedButton.classList.remove("opacity-50", "cursor-not-allowed");
            }, 2000);
        }
        // Function to close the modal
        function closeModal() {
            const modal = document.getElementById("modal");

            const resultDiv = modal.querySelector("#result-div");
            const dummyDiv = modal.querySelector("#dummy-div");
            const cancelButton = modal.querySelector("#closebtn");
            const proceedButton = modal.querySelector("#submitbtn");
        
            modal.classList.add("hidden");             
            dummyDiv.classList.remove("hidden");       
            resultDiv.classList.add("hidden");         
        
            document.getElementById("name").removeAttribute("required");

            cancelButton.disabled = true;
            proceedButton.disabled = true;
            cancelButton.classList.add("opacity-50", "cursor-not-allowed");
            proceedButton.classList.add("opacity-50", "cursor-not-allowed");
        }
        
        async function fetchBusinessData(field) {
            let str = "";

            try {
                const response = await fetch(`get_business_data/?field=${field}`);
                const data = await response.json();
                
                console.log(`Requested ${field}:`, data);

                let category = data.data.businessCategory;

                switch (category) {
                    case "Tech":
                        document.querySelectorAll("ul li").forEach(item => {
                            item.innerText = "Businesses and professionals looking for tech services.";
                        });
                        str = "Businesses and professionals looking for tech services.";
                        break;
                    case "Food":
                        document.querySelectorAll("ul li").forEach(item => {
                            item.innerText = "People seeking convenient and affordable meal options.";
                        });
                        str = "People seeking convenient and affordable meal options.";
                        break;
                    case "Clothing":
                        document.querySelectorAll("ul li").forEach(item => {
                            item.innerText = "Young adults and fashion-conscious consumers.";
                        });
                        str = "Young adults and fashion-conscious consumers.";
                        break;
                    case "Expert":
                        document.querySelectorAll("ul li").forEach(item => {
                            item.innerText = "People seeking professional services.";
                        });
                        str = "People seeking professional services.";
                        break;
                }
                document.getElementById("targetMarket").value = str;
                return str;

            } catch (error) {
                console.error("Error fetching data:", error);
                return "Error fetching data";
            }
        }
        fetchBusinessData("businessCategory");  // Fetch business category

        
        // JS handler before form submission
        document.getElementById('marketResearchForm').addEventListener('submit', function(event) {
            let savedLocationData = {
                "home-based": {
                    location: "Home-Based",
                    targetMarket: "Teens and young adults, Small businesses, Event organizers",
                    maxEmployee: 3
                },
                "physical-store": {
                    location: "Physical Store",
                    targetMarket: "Professionals needing bespoke suits, Fashion-forward individuals, High-income earners",
                    maxEmployee: 10
                },
                "commercial-space": {
                    location: "Commercial Space",
                    targetMarket: "Working professionals, Stress-relief seekers, Health-conscious individuals",
                    maxEmployee: 20
                }
            };
            // Store selected location data in player object
            const selectedLocationData = savedLocationData[current_open_modal_id];
            updatePlayerProperty("businessLocation", selectedLocationData);
            addOption1ToPlayerObject();
            printPlayerInfo();
            event.preventDefault();
        });

        // Moves information from sessionStorage to player object
        function addOption1ToPlayerObject() {
            // Define business types (same as in mod1_t1_t2.js)
            const businessTypes = [
                "Tech Repair and Support Service",
                "IoT Device Development",
                "Web Development Services",
                "Specialty Coffee Shop",
                "Artisan Bakery",
                "Food Truck Business",
                "Custom Tailored Clothing Service",
                "Activewear Line",
                "Online T-Shirt Printing",
                "Spa and Massage Center",
                "Home Cleaning Service",
                "Interior Design and Home Staging"
            ];
            const option1 = sessionStorage.getItem('option1'); // Business type index
            const businessType = option1 !== null && businessTypes[parseInt(option1)] ? businessTypes[parseInt(option1)] : "Not Selected";
            updatePlayerProperty("businessType", businessType);
        }

        // Card Element height adjustment
        function adjustCardHeights() {
            const titles = document.querySelectorAll('.location-title')
            const descs = document.querySelectorAll('.desc-preview');
            const lists = document.querySelectorAll('.list-disc');
            let pMaxHeight = 0;
            let lMaxHeight = 0;

            // Reset heights to auto and find the tallest for <p>
            descs.forEach(p => {
                p.style.height = 'auto';
                const h = p.offsetHeight;
                if (h > pMaxHeight) pMaxHeight = h;
            });
            descs.forEach(p => {
                p.style.height = pMaxHeight + 'px';
            });

            // Reset heights to auto and find the tallest for <ul>
            lists.forEach(ul => {
                ul.style.height = 'auto';
                const h = ul.offsetHeight;
                if (h > lMaxHeight) lMaxHeight = h;
            });
            lists.forEach(ul => {
                ul.style.height = lMaxHeight + 'px';
            });
        }
        document.addEventListener('DOMContentLoaded', adjustCardHeights);
        window.addEventListener('resize', adjustCardHeights);
    </script>
</body>
</html>